var PI,campaign,__slice=[].slice,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};PI=window.PI=window.PI||{},ko.extenders.money=function(e,t){return t==null&&(t={}),ko.computed({read:function(){var n;n=e();if(n!=null&&!isNaN(n))return accounting.formatMoney(n,t);return},write:function(t){var n;n=e();if(t!==n)return e(t)}})},ko.extenders.number=function(e,t){return t==null&&(t={}),ko.computed({read:function(){var n;n=e();if(n!=null&&!isNaN(n))return accounting.formatMoney(n,t);return},write:function(t){var n;n=e();if(t!==n)return e(t)}})},PI.Schema=function(){function e(e,t){jQuery.isFunction(e)||(t=e,e=void 0),this.model=e,this.mapping=t!=null?t:{}}return e.prototype.key=function(e,t){var n,r;return e&&t&&((r=(n=this.mapping)[e])==null&&(n[e]={}),this.mapping[e].key=t),this},e.prototype.map=function(e,t){var n,r;return e&&t&&((r=(n=this.mapping)[e])==null&&(n[e]={}),this.mapping[e].create=t,this.mapping[e].update=t),this},e.prototype.mapMoment=function(){var e,t,n,r,i;t=1<=arguments.length?__slice.call(arguments,0):[],i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(this.map(e,function(e){var t;return t=moment(e.data),e.observable?t:ko.observable(t)}));return i},e.prototype.update=function(e,t){var n,r;return e&&t&&((r=(n=this.mapping)[e])==null&&(n[e]={}),this.mapping[e].update=t),this},e.prototype.addList=function(){var e,t,n,r,i,s,o;n=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[];if(t.length>0){(o=(r=this.mapping)[n])==null&&(r[n]=[]);for(i=0,s=t.length;i<s;i++)e=t[i],jQuery.isArray(e)?(e=e.slice(),e.unshift(n),this.addList.apply(this,e)):this.mapping[n].push(e);return this.mapping[n].length<1&&delete this.mapping[n],this}return this},e.prototype.ignore=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],e.unshift("ignore"),this.addList.apply(this,e),this},e.prototype.include=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],e.unshift("include"),this.addList.apply(this,e),this},e.prototype.copy=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],e.unshift("copy"),this.addList.apply(this,e),this},e.prototype.load=function(e,t){return!t&&this.model&&(t=this.model()),t?(ko.mapping.fromJS(e,this.mapping,t),t):ko.mapping.fromJS(e,this.mapping)},e.prototype.dump=function(e){if(e)return ko.mapping.toJS(e)},e}(),PI.schema=new PI.Schema,PI.Model=function(){function e(e){var t;this.schema=(t=this.constructor.schema)!=null?t:PI.schema,this.schema.load(e,this)}return e.load=function(e){return new this(e)},e.prototype.update=function(e){return this.schema.load(e,this),this},e}(),PI.Page=function(){function e(e){e==null&&(e={})}return e.init=function(e){var t;return t=PI.page=new this(e),t.render(),t},e.prototype.render=function(){return ko.applyBindings(this),this},e}(),PI.Modal=function(){function e(){this.submit=__bind(this.submit,this),this.cancel=__bind(this.cancel,this),this.open=__bind(this.open,this),this.toggle=__bind(this.toggle,this),this.visible=ko.observable(!1),this.el=this.getElement(),this.visible.subscribe(this.onVisible,this)}return e.prototype.show=function(){return this.visible(!0)},e.prototype.hide=function(){return this.visible(!1)},e.prototype.toggle=function(){return this.visible(!this.visible())},e.prototype.open=function(){return this.reset(),this.show()},e.prototype.cancel=function(){return this.reset(),this.hide()},e.prototype.submit=function(){},e.prototype.reset=function(){},e.prototype.onVisible=function(e){e&&this.el.modal("show");if(!e)return this.el.modal("hide")},e}(),PI.UploadModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.getElement=function(){return jQuery("#uploader").modal({show:!1,backdrop:"static",keyboard:!0})},t}(PI.Modal),PI.UserProfile=function(e){function t(e,t){this.opts=t!=null?t:{},this.publicLabel=ko.observable("public"),this.isPublic=ko.observable(!0)}return __extends(t,e),t.prototype.setPublic=function(){var e;return this.isPublic(!this.isPublic()),this.isPublic()&&(e="public"),this.isPublic()||(e="private"),this.publicLabel(e)},t}(PI.Page),campaign=new PI.Schema,campaign.mapMoment("started","deadline"),PI.CampaignTarget=function(e){function t(e){t.__super__.constructor.call(this,e),this.valueUI=ko.computed(this.getValueUI,this)}return __extends(t,e),t.prototype.getValueUI=function(){var e,t;e=typeof this.type=="function"?this.type():void 0,t=typeof this.value=="function"?this.value():void 0;if(e==="money")return accounting.formatMoney(t,{precision:0});if(e==="number")return t=accounting.formatNumber(t,{precision:0}),t!=null?t+" Poold in":t},t}(PI.Model),PI.Campaign=function(e){function t(e){var n;e==null&&(e={}),n=this.extractTarget(e),t.__super__.constructor.call(this,e),this.days=ko.observable(),this.hours=ko.observable(),this.minutes=ko.observable(),this.seconds=ko.observable(),this.remaining=ko.observable(),this.deadline.subscribe(this.refreshTimes,this),this.refreshTimes(),n&&(this.target=ko.observable(n)),n||(this.target=ko.observable()),this.balanceUI=this.balance.extend({money:{precision:0}}),this.progress=ko.computed(this.getProgress,this),this.progressUI=this.progress.extend({number:{precision:0,format:"%v%"}})}return __extends(t,e),t.schema=campaign,t.prototype.extractTarget=function(e){var t,n,r,i;return e==null&&(e={}),t=e.target===null,n=e.target,delete e.target,e.target_type&&(n==null&&(n={}),(r=n.type)==null&&(n.type=e.target_type),delete e.target_type),e.target_value&&(n==null&&(n={}),(i=n.value)==null&&(n.value=e.target_value),delete e.target_value),t&&!n?null:n?PI.CampaignTarget.load(n):void 0},t.prototype.update=function(e){var n;return n=this.extractTarget(e),t.__super__.update.call(this,e),(n||n===null)&&this.target(n),this},t.prototype.getProgress=function(){var e,t,n,r,i;return t=(r=this.target())!=null?typeof r.type=="function"?r.type():void 0:void 0,n=(i=this.target())!=null?typeof i.value=="function"?i.value():void 0:void 0,t==="money"&&(e=this.balance()),t!=="money"&&(e=this.participants()),e==null||isNaN(e)||e<0?0:n==null||isNaN(n)?0:Math.min(e/n*100,100)},t.prototype.refreshTimes=function(e){var t,n;return e==null&&(e=this.deadline()),t=e.diff(),n=moment.duration(t),this.days(Math.round(n.asDays())),this.hours(Math.round(n.hours())),this.minutes(Math.round(n.minutes())),this.seconds(Math.round(n.seconds())),this.remaining(Math.round(n.asSeconds()))},t}(PI.Model),PI.CampaignCreate=function(e){function t(e){this.opts=e!=null?e:{},this.uploader=new PI.UploadModal,this.campaignType=ko.observable(),this.campaignType.subscribe(this.onCampaignType,this),this.requiredAmount=ko.observable(),this.paymentAmountType=ko.observable(),this.paymentAmountType.subscribe(this.onPaymentAmountType,this),this.campaignContract=ko.observable(!1),this.amazonPurchase=ko.observable(!1),this.typeDependentVisible=ko.observable(!1),this.paymentTypeDependentVisible=ko.observable(!1)}return __extends(t,e),t.prototype.onCampaignType=function(e){var t;return t=e==="co-own"||e==="gift",this.toggleTypeDependents(t)},t.prototype.onPaymentAmountType=function(e){var t;return t=e==="specific",this.togglePaymentTypeDependents(t)},t.prototype.toggleTypeDependents=function(e){this.typeDependentVisible(e);if(!e)return this.campaignContract(e)},t.prototype.togglePaymentTypeDependents=function(e){return this.paymentTypeDependentVisible(e),this.requiredAmount(0)},t}(PI.Page),PI.CampaignDetails=function(e){function t(e){this.campaign=ko.observable(e),this.progress=ko.computed(this.getProgress,this),this.progress.subscribe(this.renderPie,this),this.remaining=ko.computed(this.getRemaining,this),this.deadlineUI=ko.computed(this.getDeadlineUI,this),this.daysUI=ko.computed(this.getDaysUI,this),this.hoursUI=ko.computed(this.getHoursUI,this),this.minutesUI=ko.computed(this.getMinutesUI,this),this.secondsUI=ko.computed(this.getSecondsUI,this),this.remaining.subscribe(this.onRefreshRemaining,this),this.onRefreshRemaining(this.remaining()),this.uploader=new PI.UploadModal,this.manager=new PI.CampaignManager(this.uploader),this.promote=new PI.CampaignPromote,this.disburse=new PI.CampaignDisburse,this.payment=new PI.PaymentModal(this)}return __extends(t,e),t.prototype.getProgress=function(){return this.campaign().progress()},t.prototype.getDeadlineUI=function(){var e,t,n,r;return t=this.campaign().deadline(),n=t.format("MMM").toUpperCase(),e=t.format("Do"),r=t.format("YYYY"),""+n+" "+e+" "+r},t.prototype.getDaysUI=function(){var e;return e=this.campaign().days(),e===1?e+" day":e+" days"},t.prototype.getHoursUI=function(){var e;return e=this.campaign().hours(),e===1?e+" hour":e+" hours"},t.prototype.getMinutesUI=function(){var e;return e=this.campaign().minutes(),e===1?e+" min":e+" mins"},t.prototype.getSecondsUI=function(){var e;return e=this.remaining(),e>9?":"+e:":0"+e},t.prototype.getRemaining=function(){return this.campaign().remaining()},t.prototype.pieData=function(e){var t,n,r,i;return e&&e>0||(e=0),e>100&&(e=100),r=100-e,i=0,e<100&&(e<=50&&(i=-180*(r/100)),e>50&&(i=180*(e/100))),t=["#739b9e","#fff"],e<=50&&t.reverse(),e>=100&&(t=["#739b9e"]),e>=100&&(n=[100]),e<100&&(n=[e,r]),{total:e,remaining:r,rotation:i,data:n,colors:t}},t.prototype.render=function(){return t.__super__.render.call(this),this.renderGraph("#pie-chart"),this},t.prototype.renderGraph=function(e,t,n,r,i,s){var o;e=jQuery(e),t==null&&(t=200),n==null&&(n=200),r==null&&(r=100),i==null&&(i=100),s==null&&(s=100);if(!(e&&e.length>0))return;return o=Raphael(e[0],200,200),this.renderPie(this.progress(),o,r,i,s)},t.prototype.renderPie=function(e,t,n,r,i){var s,o;t==null&&(t=this.graph);if(!t)return;return t.clear(),s=this.pieData(e),o=t.piechart(n,r,i,s.data,{init:.1,colors:s.colors}),s.rotation&&o.rotate(s.rotation),t.circle(n,r,i*.98).animate({stroke:"#747C7D","stroke-width":2}).blur(),t.circle(n,r,i*.99).animate({stroke:"#aaa","stroke-width":1}),t.circle(n,r,i*.7).animate({stroke:"#747C7D","stroke-width":2}),t.circle(n,r,i*.72).animate({stroke:"#747C7D","stroke-width":2}).blur(),t.circle(n,r,i*.7).animate({stroke:"#aaa","stroke-width":1,fill:"#fff"}),this},t.prototype.delayRefresh=function(e){var t,n=this;return this.timeout&&clearTimeout(this.timeout),t=function(){return n.timeout&&clearTimeout(n.timeout),n.campaign().refreshTimes()},this.timeout=setTimeout(t,e)},t.prototype.onRefreshRemaining=function(e){var t;if(e<=0)return;return t=60,e<61&&(t=1),this.delayRefresh(1e3*t)},t}(PI.Page),PI.CampaignManager=function(){function e(e){var t=this;this.uploader=e,this.tab=ko.observable(),this.tab.subscribe(this.onTab,this),this.navigate(location.hash),this.visible=ko.observable(!!this.tab()),jQuery('.nav-tabs.manage a[data-toggle="tab"]').on("shown",function(e){return t.navigate(jQuery(e!=null?e.target:void 0).attr("href"))})}return e.prototype.show=function(){return this.visible(!0)},e.prototype.hide=function(){return this.visible(!1)},e.prototype.toggle=function(){return this.visible(!this.visible())},e.prototype.navigate=function(e){return e=(e!=null?e:"").replace(/^#/g,""),(e==="manage"||e==="promote"||e==="disburse")&&this.tab(e),this},e.prototype.onTab=function(){var e;e=this.tab();if(!e)return;return jQuery(".nav-tabs li a[href=#"+e+"]").tab("show")},e.prototype.cancel=function(){return this.reset(),this.hide()},e.prototype.reset=function(){},e.prototype.submit=function(){},e}(),PI.CampaignPromote=function(){function e(){}return e.prototype.cancel=function(){return this.reset(),this.hide()},e.prototype.reset=function(){},e.prototype.submit=function(){},e}(),PI.CampaignDisburse=function(){function e(){}return e.prototype.cancel=function(){return this.reset(),this.hide()},e.prototype.reset=function(){},e.prototype.submit=function(){},e}(),PI.PaymentModal=function(e){function t(e){this.resetModal=__bind(this.resetModal,this),this.finishAndCreate=__bind(this.finishAndCreate,this),this.finish=__bind(this.finish,this),this.paymentCallback=__bind(this.paymentCallback,this),this.submitPayment=__bind(this.submitPayment,this),t.__super__.constructor.call(this),this.page=e,this.loginPage=ko.observable(logInUser()),this.formPage=ko.observable(!this.loginPage()),this.processingPage=ko.observable(!1),this.successPage=ko.observable(!0),this.form=new PI.PaymentForm}return __extends(t,e),t.prototype.getElement=function(){return jQuery("#payment").modal({show:!1,backdrop:"static",keyboard:!0})},t.prototype.open=function(){t.__super__.open.call(this);if(this.page.renderedPaymentModal)return;return this.page.renderGraph("#modal-pie-chart-login",150,150,75,75,75),this.page.renderGraph("#modal-pie-chart-success",150,150,75,75,75),this.page.renderGraph("#modal-pie-chart",150,150,75,75,75),this.page.renderedPaymentModal=!0},t.prototype.submitPayment=function(){var e;return this.form.valid()||this.displayErrors(),this.processingPage(!0),e=jQuery(".processing-spinner")[0],this.spinner=this.buildSpinner(),this.spinner.spin(),e.appendChild(this.spinner.el),setTimeout(this.paymentCallback,2500)},t.prototype.paymentCallback=function(e){return this.paymentSuccess()},t.prototype.paymentSuccess=function(){return this.spinner.stop(),this.processingPage(!1),this.formPage(!1),this.successPage(!0)},t.prototype.displayErrors=function(){},t.prototype.buildSpinner=function(){var e;return e={lines:8,length:7,width:5,radius:10,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner"},Spinner(e)},t.prototype.finish=function(){return this.cancel(),setTimeout(this.resetModal,1e3)},t.prototype.finishAndCreate=function(){var e;return this.finish(),e=function(){return window.location="/campaign/new"},setTimeout(e,1e3)},t.prototype.resetModal=function(){return this.form.paymentAmount("$0.00"),this.successPage(!1),this.formPage(!0)},t}(PI.Modal),PI.PaymentForm=function(e){function t(){this.paymentAmount=ko.observable("$0.00"),this.firstName=ko.observable(),this.lastName=ko.observable(),this.address=ko.observable(),this.city=ko.observable(),this.state=ko.observable(),this.country=ko.observable(),this.postalCode=ko.observable(),this.ccNumber=ko.observable(),this.ccvNumber=ko.observable(),this.expirationMonth=ko.observable(),this.expirationYear=ko.observable()}return __extends(t,e),t.prototype.valid=function(){return!0},t}(PI.Model);